<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	<style>html {
    width: 100vw;
    overflow-x: hidden;
}

body {
    margin: 0;
    padding: 0;
    font-family: sans-serif;
    user-select: none;
}

h1 {
    margin: 0;
    padding: 0;

    font-weight: 300;
    font-size: 32px;
}


header {
    display: flex;
    column-gap: 6px;
    align-items: center;
    justify-content: center;
    
    padding-bottom: 16px;
    padding-right: 12px;
}

header #logo {
    width: 130px;
    height: auto;
}



input {
    user-select: all !important;
    width: 30%;
    
    padding: 0;
    margin: 0;
    border: none;
    outline: none;

    color: #0f71a9;
    border-bottom: 1px solid rgb(11 53 76 / 8%);
    border-radius: 4px;
    padding: 8px 6px;

    font-family: inherit;
    font-size: 18px;
    font-weight: 600;
    text-align: right;

    height: 100%;
}

input.wide-input { width: 50%; }

input[type="checkbox"] { width: 18px; height: 18px; }

span { font-size: 14px; }

img, svg { width: 22px; height: 22px; }

.input-row {
    margin-top: 6px;
    margin-bottom: 6px;
    height: 38px;
}



.grid-parent {
    user-select: none;

    position: relative;
    width: calc(100% + 24px);
    left: -12px;

    margin-bottom: 8px;
    background-color: #f9f9f9;
    padding: 14px;
    box-sizing: border-box;
    padding-bottom: 18px;
}

.grid-parent .grid-container {
    position: relative;
    margin-bottom: 16px;
    width: 100%;
}

.grid-container .display-container {
    position: relative;
    left: 50%;
    transform: translateX(-50%);
}

.grid-container .merge-container {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);

    width: 100%;
    height: 100%;
    pointer-events: none;
}



.body-container {
    height: 100vh;

    display: grid;
    grid-template-rows: 1fr 72px;
}

.body-content {
    padding: 0 12px;
    padding-bottom: 22px;
    overflow-y: scroll;
}



.align {
    display: flex;
    align-items: center;
    flex-direction: row;
    column-gap: 6px;
}

.fill {
    flex-grow: 100;
}

.vertical {
    flex-direction: row;
}

.button-container-bottom {
    position: fixed;
    bottom: 0;
    width: 100vw;
    height: 64px;
    padding: 6px;
    box-sizing: border-box;
    background-color: white;
}

.button-container-hover {
    padding: 6px;
    height: 64px;
    box-sizing: border-box;
}

.button-container {
    box-sizing: border-box;
    
    width: 100%;
    height: 100%;

    display: flex;
    border-radius: 6px;
    overflow-x: hidden;
    overflow-y: hidden;
}

.button {
    cursor: pointer;
    justify-content: center;
    flex-grow: 50;
    transition: flex-grow 0.2s ease-out;
    background-color: black;
    color: white;
}

.colour {
    background-color: #3496F0;
    color: white;
}

.faded {
    background-color: #F9F9F9;
}

.app-help-container svg {
    margin-left: auto;
    margin-right: auto;
    display: block;

    height: 24px;
    width: 24px;
    opacity: 0.8;
}

#app-description {
    text-align: center;
    font-size: 12px;
    line-height: 1.8;
    opacity: 0.45;
    margin-top: 22px;
}

.border {
    width: 100%;
    height: 1px;
    background-color: rgba(0,0,0,0.04);
    margin-top: 22px;
    margin-bottom: 22px;
}

#clear-merge { min-width: fit-content; }

#clear-merge:hover { text-decoration: underline; }

#help-icon {
    display: block;
    width: 22px;
    height: 22px;
    background-color: orange;
    margin: 0 auto;
}

.help-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    margin-top: 38px;
    column-gap: 8px;
    cursor: help;
    color: #0f71a9;
}

.help-button:hover {
    text-decoration: underline;
}


.help-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: white;
    z-index: 999;

    box-sizing: border-box;
    overflow-y: scroll;

    visibility: hidden;
}

.help-screen .inner-content {
    padding-bottom: 86px;
}

.help-screen h3,h4,h5 {
    margin: 0;
    padding: 0; 
    display: block;
}

.help-screen .top-row {
    opacity: 0.6;
    margin-bottom: 4px;
}

.help-screen .grid-parent {
    z-index: -99;
}

.help-screen .help-top-section {
    margin-top: 4px;
    border-top: 1px solid rgba(0,0,0,0.04);
    padding: 0 22px;
    padding-top: 48px;
    padding-bottom: 52px;
    text-align: center;
}

.help-screen.opening {
    visibility: visible;
    animation-name: opening;
    animation-timing-function: ease-out;
    animation-duration: 0.15s;

    opacity: 1;
}

.help-screen.closing {
    visibility: visible;
    animation-name: closing;
    animation-duration: 0.3s;
    animation-timing-function: ease-in;
}

@keyframes opening {
    from {
        transform: translateY(50vh);
        opacity: 0;
    } to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes closing {
    from {
        transform: translateY(0);    
        opacity: 1;
    } to {
        transform: translateY(100vh);
        opacity: 0;
    }
}

.help-items h4 { margin-top: 26px; }

.help-items h5 { margin-top: 16px; }

.help-items {
    padding: 22px;
    margin-top: -76px;
}

/* .help-items .help-row { */
    /* margin-bottom: 22px; */
/* } */

.help-items svg {
    width: 100%;
    height: 200px;
    /* background-color: orange; */
}

.help-items p {
    margin: 0;
    margin-top: 8px;
    display: block;
    line-height: 1.5;
    font-size: 14px;
}


#select-saved select {
    padding: 0;
    border: none;
    appearance: auto;
    background-color: transparent;
    color: #093a58;

    font-size: 14px;
    font-weight: 500;

    opacity: 0.5;
    font-family: inherit;

    text-align: right;
    width: 90px;
}





.input-overlay.opening {
    visibility: visible;
    animation-name: overlay-opening;
    animation-timing-function: ease-out;
    animation-duration: 0.3s;

    /* transform: translateY(0); */
    opacity: 1;
    /* animation-fill-mode: forwards; */
}

.input-overlay.closing {
    visibility: visible;
    animation-name: overlay-closing;
    animation-duration: 0.3s;
    animation-timing-function: ease-in;
}

@keyframes overlay-opening {
    from {
        padding-top: 440px;
        opacity: 0;
    } to {
        padding: 0;
        opacity: 1;
    }
}

@keyframes overlay-closing {
    from {
        padding-top: 0px;
        opacity: 1;
    } to {
        padding-top: 440px;
        opacity: 0;
    }
}

.input-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: #000000d9;
    z-index: 999;

    display: grid;
}

.input-overlay.equally-divided {
    grid-template-rows: 1fr 1fr;
}

.input-overlay.flex {
    grid-template-rows: 4fr 1fr;
}

.input-overlay.flex .top-container {
    flex-grow: 100;
    padding-top: 46px;
}

.input-overlay #confirm-button {
    padding: 18px 46px;
    background-color: orange;
    border-radius: 500px;

    color: white;
    cursor: pointer;
}

.input-overlay #cancel-button {
    padding: 14px;
    background-color: rgba(255,255,255,0.15);
    border-radius: 500px;

    color: white;
    cursor: pointer;
}

.input-overlay .top-container, .bottom-container {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    flex-direction: column;
    row-gap: 12px;
}

.input-overlay .bottom-container {
    padding-bottom: 44px;
}

.input-overlay .title {
    width: 198px;
    font-size: 18px;
    color: white;
    text-align: center;
}

.input-overlay input {
    background-color: white;
    padding: 12px;
    padding-bottom: 11px;
    height: 46px;
    width: 198px;

    color: black;

    font-size: 14px;
    text-align: left;
}


.new-feature-card:hover { transform: translateY(-10px) rotate(2deg); }
.new-feature-card {
    position: relative;

    padding: 12px;
    background-color: #e4dace;
    border-radius: 6px;

    transition: transform 0.2s;
}

.new-feature-card .card-close {
    position: absolute;
    right: 12px;
    top: 12px;
    padding: 6px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.new-feature-card .card-close:hover {
    background-color: rgba(0,0,0,0.25);
}

.new-feature-card .card-close svg {
    width: 18px;
    height: 18px;
}

.new-feature-card .card-content .card-title {
    display: block;
    font-size: 16px;
    margin-top: 6px;
    margin-bottom: 2px;
}

.new-feature-card .card-content ul {
    padding-left: 16px;
}

.new-feature-card .card-content li {
    line-height: 1.6;
    font-size: 14px;
    color: rgba(0,0,0,0.8);
}

.new-feature-card .card-content b {
    line-height: 1.6;
    color: black;
}</style>

	<div class="help-screen">
		<div class="inner-content">
			<div class="grid-parent">
				<header>
					<img id="logo" src="https://assetbucket-a492924.s3.eu-west-2.amazonaws.com/logo.svg" alt="">
				</header>
				<div class="help-top-section">
					<h5 class="top-row">Help Section</h5>
					<h3>Learn To Use (Easy)grid</h3>
				</div>
			</div>
			
			<div class="help-items">
				<svg width="325" height="200" viewBox="0 0 325 200" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="325" height="200" fill="#F8F8F8"/>
<rect x="90" y="27" width="68.5" height="68.5" fill="url(#paint0_linear_227_70)" fill-opacity="0.6"/>
<rect x="90" y="103.5" width="30.25" height="68.5" fill="url(#paint1_linear_227_70)" fill-opacity="0.6"/>
<rect x="128.25" y="103.5" width="68.5" height="30.25" fill="url(#paint2_linear_227_70)" fill-opacity="0.6"/>
<rect x="128.25" y="141.75" width="68.5" height="30.25" fill="url(#paint3_linear_227_70)" fill-opacity="0.6"/>
<rect x="166.5" y="27" width="68.5" height="68.5" fill="url(#paint4_linear_227_70)" fill-opacity="0.6"/>
<rect x="204.75" y="103.5" width="30.25" height="68.5" fill="url(#paint5_linear_227_70)" fill-opacity="0.6"/>
<defs>
<linearGradient id="paint0_linear_227_70" x1="124.25" y1="27" x2="124.25" y2="95.5" gradientUnits="userSpaceOnUse">
<stop stop-color="#E4E4E4"/>
<stop offset="1" stop-color="#E7E7E7"/>
</linearGradient>
<linearGradient id="paint1_linear_227_70" x1="105.125" y1="103.5" x2="105.125" y2="172" gradientUnits="userSpaceOnUse">
<stop stop-color="#E4E4E4"/>
<stop offset="1" stop-color="#E7E7E7"/>
</linearGradient>
<linearGradient id="paint2_linear_227_70" x1="162.5" y1="103.5" x2="162.5" y2="133.75" gradientUnits="userSpaceOnUse">
<stop stop-color="#E4E4E4"/>
<stop offset="1" stop-color="#E7E7E7"/>
</linearGradient>
<linearGradient id="paint3_linear_227_70" x1="162.5" y1="141.75" x2="162.5" y2="172" gradientUnits="userSpaceOnUse">
<stop stop-color="#E4E4E4"/>
<stop offset="1" stop-color="#E7E7E7"/>
</linearGradient>
<linearGradient id="paint4_linear_227_70" x1="200.75" y1="27" x2="200.75" y2="95.5" gradientUnits="userSpaceOnUse">
<stop stop-color="#E4E4E4"/>
<stop offset="1" stop-color="#E7E7E7"/>
</linearGradient>
<linearGradient id="paint5_linear_227_70" x1="219.875" y1="103.5" x2="219.875" y2="172" gradientUnits="userSpaceOnUse">
<stop stop-color="#E4E4E4"/>
<stop offset="1" stop-color="#E7E7E7"/>
</linearGradient>
</defs>
</svg>

				<h4>Basic Grids</h4>
				<p>To create a grid, set the columns, rows, column gap, and row gap. These options determine how the grid will look, and can be previewed before adding to project in the preview area at the top of the screen. </p>

				<h5>Values</h5>
				<p>Column / row values are written as their cell sizes in whole numbers (with a pt suffix), or out of a total fraction, with the denominator of that fraction being all the numerators written added up. All cell values must be separated by a space. The value entered can also be a single number to create x amount of equally sized cells.

					Column / row gaps are written as a whole number</p>

				<h5>Examples</h5>
				<p>Try the following in the column/row inputs to see how they change the grid:
					<b><br>1 2 3 4 5<br>40pt 1<br>20pt 1 20pt<br>30pt*3 2*2 1</p></b>

				<h4>Adding Grid To Project</h4>
				<p>Once you are happy with your grid layout, you can add it into your Figma document. To do so, select the layer you want to apply the grid to, if not already selected, and click the “Apply Grid To Selected” button, you should see the grid over the selected layer, filled with the colour chosen in the “Cell Fill Colour”</p>

				<h4>Merging Cells</h4>
				<p>To create more complicated grids, you can build a custom layout by clicking on the cells (in the preview) that you want. Clicking on “Apply Grid To Selected” now would only import the cells that have been selected. You can deselect a cell by right clicking on it, and you can merge multiple cells together to create a larger tile by holding on a cell and dragging it the appropriate size.</p>
				
				<h4>More Help</h4>
				<p>For more information and help, visit our website at <a target="_blank" href="https://easygrid-app.web.app/">easygrid-app.web.app</a>. Additionally, we answer all questions posted in the figma plugin comments area.</p>
			</div>	
		</div>

		<div class="button-container-bottom" style="background-color: unset; height: 80px; padding-bottom: 16px;">
			<div class="button-container" style="width: 60px; margin: 0 auto;">
				<div id="close-help-button" class="button align horizontal">
					<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M90 90L423 423" stroke="white" stroke-width="52" stroke-linecap="round"/>
<path d="M423 90L90 423" stroke="white" stroke-width="52" stroke-linecap="round"/>
</svg>

				</div>
			</div>
		</div>
	</div>
	
	<div class="body-container">
		<div class="body-content">
			<div class="grid-parent">
				<header>
					<img id="logo" src="https://assetbucket-a492924.s3.eu-west-2.amazonaws.com/logo.svg" alt="">
				</header>
	
				<div id="grid-root" class="grid-container">
				</div>
	
				<div class="align horizontal">
					<div id="current-frame-name" class="align horizontal">
						<img src="https://assetbucket-a492924.s3.eu-west-2.amazonaws.com/frame.svg" alt="">
						<span>Frame 2</span>
					</div>
					<div class="fill"></div>
					<div id="clear-merge" class="align horizontal">
						<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M140.887 436.992H372.105C414.598 436.992 436.992 414.789 436.992 372.871V140.312C436.992 98.3945 414.598 76 372.105 76H140.887C98.5859 76 76 98.3945 76 140.312V372.871C76 414.789 98.5859 436.992 140.887 436.992ZM195.629 337.844C184.527 337.844 175.914 329.23 175.914 317.938C175.914 312.961 178.02 307.984 181.848 304.348L229.508 256.688L181.848 208.836C178.02 205.199 175.914 200.223 175.914 195.246C175.914 184.145 184.527 175.531 195.629 175.531C201.371 175.531 205.773 177.445 209.793 181.273L257.262 228.742L305.305 181.082C309.324 177.062 313.918 175.34 319.469 175.34C330.379 175.34 339.184 183.953 339.184 194.863C339.184 200.223 337.27 204.816 333.25 208.836L285.59 256.688L333.059 304.156C337.078 307.793 338.992 312.77 338.992 317.938C338.992 329.23 330.379 337.844 319.277 337.844C313.344 337.844 308.559 335.93 304.73 332.102L257.262 284.633L210.176 332.102C206.348 335.93 201.371 337.844 195.629 337.844Z" fill="black"/>
</svg>

						<span>Clear Merges</span>
					</div>
				</div>
			</div>
	
			<div class="align horizontal input-row">
				<div class="align horizontal">
					<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M103 449V474H153V449H103ZM103 63V449H153V63H103Z" fill="#18A0FB"/>
<path d="M231 449V474H281V449H231ZM231 63V449H281V63H231Z" fill="#18A0FB"/>
<path d="M359 449V474H409V449H359ZM359 63V449H409V63H359Z" fill="#18A0FB"/>
</svg>

					<span>Grid Columns</span>
				</div>
				<div class="fill"></div>
				<input id="grid-columns" config="grid_columns" placeholder="Try (1 3 1, 5, 30pt 1)" class="wide-input" type="text" value="5*2">
			</div>
	
			<div class="align horizontal input-row">
				<div class="align horizontal">
					<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M449 153L474 153L474 103L449 103L449 153ZM449 103L63 103L63 153L449 153L449 103Z" fill="#18A0FB"/>
<path d="M449 281L474 281L474 231L449 231L449 281ZM449 231L63 231L63 281L449 281L449 231Z" fill="#18A0FB"/>
<path d="M449 409L474 409L474 359L449 359L449 409ZM449 359L63 359L63 409L449 409L449 359Z" fill="#18A0FB"/>
</svg>

					<span>Grid Rows</span>
				</div>
				<div class="fill"></div>
				<input id="grid-rows" config="grid_rows" placeholder="Try (1 3 1, 5, 30pt 1)" class="wide-input" type="text" value="5*2">
			</div>
	
			<div class="align horizontal input-row">
				<div class="align horizontal">
					<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M359 449L359 474L409 474L409 449L359 449ZM409 449L409 63L359 63L359 449L409 449Z" fill="#18A0FB"/>
<path d="M103 449L103 474L153 474L153 449L103 449ZM153 449L153 63L103 63L103 449L153 449Z" fill="#18A0FB"/>
<path d="M302.5 255.615L209.5 255.615" stroke="#18A0FB" stroke-width="40"/>
<path d="M286 314L286 199L325.394 256.5L286 314Z" fill="#18A0FB"/>
<path d="M226.5 199L226.5 314L187.106 256.5L226.5 199Z" fill="#18A0FB"/>
</svg>

					<span>Column Gap (pt)</span>
				</div>
				<div class="fill"></div>
				<input id="grid-columns-gap" config="grid_columns_gap" placeholder="Gap (Enter Number)" type="text" value="0">
			</div>
	
			<div class="align horizontal input-row">
				<div class="align horizontal">
					<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M449 153L474 153L474 103L449 103L449 153ZM449 103L63 103L63 153L449 153L449 103Z" fill="#18A0FB"/>
<path d="M449 409L474 409L474 359L449 359L449 409ZM449 359L63 359L63 409L449 409L449 359Z" fill="#18A0FB"/>
<path d="M255.615 209.5L255.615 302.5" stroke="#18A0FB" stroke-width="40"/>
<path d="M314 226H199L256.5 186.606L314 226Z" fill="#18A0FB"/>
<path d="M199 285.5L314 285.5L256.5 324.894L199 285.5Z" fill="#18A0FB"/>
</svg>

					<span>Row Gap (pt)</span>
				</div>
				<div class="fill"></div>
				<input id="grid-rows-gap" config="grid_rows_gap" placeholder="Gap (Enter Number)" type="text" value="0">
			</div>
	
			<div class="border"></div>
	
			<div class="align horizontal input-row">
				<div class="align horizontal">
					<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<path opacity="0.6" d="M269.244 405.92C333.404 405.92 376.324 383.068 376.324 349.23C376.324 319.641 352.008 313.488 352.008 296.203C352.008 272.619 436.529 268.664 436.529 207.141C436.529 146.35 373.688 106.066 280.084 106.066C158.502 106.066 76.4707 167.59 76.4707 258.41C76.4707 346.74 154.254 405.92 269.244 405.92ZM284.186 200.402C270.562 200.402 259.137 189.27 259.137 175.5C259.137 161.73 270.562 150.598 284.186 150.598C298.102 150.598 309.088 161.73 309.088 175.5C309.088 189.416 298.102 200.402 284.186 200.402ZM204.498 224.279C187.213 224.279 173.443 210.656 173.443 193.371C173.443 176.232 187.213 162.756 204.498 162.756C221.344 162.756 235.26 176.232 235.26 193.371C235.26 210.656 221.49 224.279 204.498 224.279ZM355.23 213.146C343.951 213.146 334.723 204.064 334.723 192.785C334.723 181.799 343.951 172.57 355.23 172.57C366.217 172.57 375.299 181.945 375.299 192.785C375.299 203.918 366.363 213.146 355.23 213.146ZM146.783 277.16C133.307 277.16 122.027 265.734 122.027 252.111C122.027 238.928 133.746 227.648 146.783 227.648C160.406 227.648 171.393 238.488 171.393 252.111C171.393 265.734 160.406 277.16 146.783 277.16ZM267.047 349.084C244.635 349.084 226.324 330.627 226.324 308.068C226.324 285.656 244.635 267.199 267.047 267.199C289.605 267.199 308.062 285.656 308.062 308.068C308.062 331.066 290.045 349.084 267.047 349.084Z" fill="black"/>
</svg>

					<span>Cell Fill Color</span>
				</div>
				<div class="fill"></div>
				<input id="cell-fill" value="#2EEA89" type="color">
			</div>
	
			<div class="align horizontal input-row">
				<div class="align horizontal">
					<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<path opacity="0.6" d="M103.303 190.002H407.551C424.396 190.002 433.332 180.041 433.332 163.049V147.668C433.332 130.676 424.396 120.715 407.551 120.715H103.303C87.3359 120.715 77.5215 130.676 77.5215 147.668V163.049C77.5215 180.041 86.6035 190.002 103.303 190.002ZM177.717 394.201H333.137C363.312 394.201 375.471 377.795 380.158 348.059L400.812 211.389H110.041L130.842 348.059C135.383 377.941 147.541 394.201 177.717 394.201ZM213.312 353.771C206.135 353.771 200.129 347.766 200.129 340.588C200.129 336.926 201.74 333.996 204.23 331.506L237.043 298.4L204.23 265.295C201.74 262.805 200.129 259.875 200.129 256.213C200.129 249.035 206.135 243.322 213.312 243.322C216.828 243.322 219.465 244.641 222.248 247.131L255.354 280.383L288.898 246.984C291.682 244.494 294.318 243.029 297.834 243.029C305.012 243.029 310.871 248.889 310.871 256.213C310.871 259.729 309.553 262.365 306.916 265.148L273.811 298.4L306.77 331.359C309.26 333.996 310.871 336.779 310.871 340.588C310.871 347.619 304.865 353.771 297.834 353.771C294.025 353.771 291.096 352.16 288.605 349.816L255.354 316.564L222.395 349.816C219.904 352.16 216.828 353.771 213.312 353.771Z" fill="black"/>
</svg>

					<span>Replace Selected With Grid</span>
				</div>
				<div class="fill"></div>
				<input id="replace-selected" type="checkbox">
			</div>
	
			<div class="border"></div>

			<div style="display: none;" class="new-feature-card">
				<div class="card-close">
					<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M90 90L423 423" stroke="black" stroke-width="52" stroke-linecap="round"/>
<path d="M423 90L90 423" stroke="black" stroke-width="52" stroke-linecap="round"/>
</svg>

				</div>
				<div class="card-content">
					<span class="card-title">Whats new?</span>
					<span class="card-subtitle">Version 1.1</span>
					<ul>
						<li>
							🎛 <b>Autopopulate — </b> you can now select more then one layer to autopopulate the layout with the other selected layers / components
						</li>
						<li>
							💾  <b>Saving — </b> Save your layout and reuse them in other Figma projects
						</li>
					</ul>
				</div>
			</div>

			<div class="help-button">
				<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M256 456.441C365.484 456.441 455.637 366.289 455.637 256.805C455.637 147.512 365.293 57.168 255.809 57.168C146.516 57.168 56.3633 147.512 56.3633 256.805C56.3633 366.289 146.516 456.441 256 456.441ZM256 412.609C169.676 412.609 100.387 343.129 100.387 256.805C100.387 170.48 169.484 101 255.809 101C342.324 101 411.613 170.48 411.805 256.805C411.996 343.129 342.324 412.609 256 412.609ZM251.406 293.938C262.508 293.938 269.973 287.812 270.738 279.773C270.93 279.008 270.93 278.051 271.121 277.477C271.887 268.098 279.16 261.59 290.836 253.934C310.168 241.684 321.461 230.773 321.461 208.953C321.461 177.18 292.559 158.23 257.531 158.23C224.801 158.23 202.023 172.586 195.707 190.77C194.367 194.215 193.602 197.469 193.602 201.297C193.602 210.867 201.258 217.375 210.062 217.375C217.336 217.375 222.504 214.504 226.523 209.145L229.203 205.699C235.52 195.746 243.941 190.961 254.469 190.961C268.633 190.961 278.203 199.383 278.203 211.25C278.203 222.734 270.164 228.285 254.277 239.387C240.879 248.766 231.117 258.336 231.117 274.605V276.52C231.117 288.004 238.391 293.938 251.406 293.938ZM251.215 353.656C264.422 353.656 274.758 344.66 274.758 331.836C274.758 319.012 264.422 310.016 251.215 310.016C238.008 310.016 227.48 319.203 227.48 331.836C227.48 344.66 238.008 353.656 251.215 353.656Z" fill="black"/>
</svg>

				<span>Open help</span>
			</div>

			<div class="app-help-container">
				<p id="app-description">To create a grid, set the columns, rows, column gap, and row gap<br>
					<br>
					Column / row values are written as their cell sizes in whole numbers (with a pt suffix), or out of a total fraction, with the denominator of that fraction being all the numerators written added up. All cell values must be separated by a space. The value entered can also be a single number to create x amount of equally sized cells.<br>
					<br>
					Try the following in the column/row inputs to see how they change the grid:<br>
					1 2 3 4 5<br>
					40pt 1<br>
					20pt 1 20pt</p>
			</div>
		</div>
	
		<div class="button-container-hover">
			<div class="button-container">
				<!-- <div id="undo" style="display: none;" class="button faded align horizontal">
					<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_150:45)">
<path d="M342.262 124.998C314.083 107.021 281.206 97.8034 247.789 98.5115C214.371 99.2197 181.914 109.821 154.522 128.976C127.13 148.131 106.033 174.978 93.8985 206.123C81.7644 237.267 79.1383 271.311 86.3523 303.948C93.5663 336.585 110.296 366.351 134.427 389.48C158.557 412.609 189.005 428.063 221.918 433.888C254.832 439.713 288.733 435.647 319.336 422.204C349.939 408.761 375.868 386.546 393.845 358.367L361.265 337.582C347.399 359.317 327.399 376.453 303.794 386.821C280.189 397.19 254.04 400.326 228.653 395.833C203.266 391.34 179.781 379.42 161.169 361.58C142.556 343.74 129.652 320.781 124.087 295.607C118.523 270.433 120.549 244.175 129.908 220.152C139.267 196.129 155.54 175.421 176.668 160.647C197.797 145.872 222.832 137.695 248.608 137.149C274.383 136.603 299.742 143.712 321.478 157.578L342.262 124.998Z" fill="black"/>
<path d="M423.631 199.758L273.09 193.091L354.135 66.0525L423.631 199.758Z" fill="black"/>
</g>
<defs>
<clipPath id="clip0_150:45">
<rect width="512" height="512" fill="white"/>
</clipPath>
</defs>
</svg>

				</div> -->
		
				<div id="apply-to-element" style="flex-grow: 100" class="button colour align horizontal">
					<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="72" y="72" width="100" height="100" rx="4" fill="white"/>
<rect x="72" y="206" width="100" height="100" rx="4" fill="white"/>
<rect x="72" y="340" width="100" height="100" rx="4" fill="white"/>
<rect x="206" y="72" width="100" height="100" rx="4" fill="white"/>
<rect x="206" y="206" width="100" height="100" rx="4" fill="white"/>
<rect x="206" y="340" width="100" height="100" rx="4" fill="white"/>
<rect x="340" y="72" width="100" height="100" rx="4" fill="white"/>
<rect x="340" y="206" width="100" height="100" rx="4" fill="white"/>
<rect x="340" y="340" width="100" height="100" rx="4" fill="white"/>
</svg>

					<span>Apply To Selected</span>
				</div>

				<div id="select-saved" style="background-color: rgb(232 232 232); display: none" class="button align horizontal">
					<select name="">
						<option value="none">View Saved...</option>
						<option value="current">Save Current</option>
						<option value="current">Simple Grid</option>
						<option value="current">4x4 Grid</option>
					</select>
				</div>
			</div>
		</div>
	</div>	

	<script>
		/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
var __webpack_exports__ = {};

;// CONCATENATED MODULE: ./scripts/TYPES.js
/**
 * Possible app events
 */
const EVENTS = {
    SelectionChanged:'SelectionChanged',
    ConfigChanged:'ConfigChanged',
    PresavedArrayChanged:'PresavedArrayChanged',

    PreviewCellGrabBegin:'PreviewCellGrabBegin',
    PreviewCellGrabEnd:'PreviewCellGrabEnd',

    MergesCleared:'MergesCleared',
    MergesUpdated:'MergesUpdated'
}

/**
 * Possible events that can be sent from the Figma code.js file
 */
const WINDOW_EVENTS = {
    SelectionChanged:'selectionchange',
    FetchedPresavedFromStorage:'presaved-fetched'
}

/**
 * Generic options that are used throughout the app
 */
const OPTIONS = {
    GridPadding:2,
    GridCornerRadius:4
}


;// CONCATENATED MODULE: ./scripts/handlers/expand-grid.js
/**
 * Expand layout string and given option into an array that includes the width (in px) for each item
 * It also returns the gap space (can change is useAppliedSize is true)
 * @param {{ pattern:String, realSize:Number, appliedSize:Number, useAppliedSize:Boolean }}
 * @returns {{ gap:function(Boolean):Number, items:function(Boolean):Array<Number> }}
 */
 /* harmony default export */ const expand_grid = (({ pattern, gap, realSize, appliedSize }) => {
	gap = parseInt(gap)
	realSize = parseInt(realSize)
	appliedSize = parseInt(appliedSize)

	const isValidElement = /^(auto|([0-9|%]+)(pt)?)(\*[0-9]+)?$/

	var elements = []
	const split = pattern.split(' ')

	/**
	 * Make sure every item in the pattern in valid and occurs as many times as needed
	 * (Based if the item has a multiplier or not)
	 */
	split.forEach(item => {
		if (!isValidElement.test(item)) return

		const split = item.split('*')

		const value = split[0]
		const multiplier = split[1] || 1

		var i = 0
		while (i < multiplier) {
			elements.push(value)
			i ++
		}
	})

	/**
	 * check if items are empty, if so make a single item, if items only contain one item then use that value as the amount of columns/rows
	 */
	if (elements.length === 0) {
        elements.push(1)
    } else if (elements.length === 1) {
        const elementZero = elements[0]

        const asNumber = parseInt(elementZero)
		const isDirectPoint = elementZero.indexOf('pt')
        if (!isNaN(asNumber) && isDirectPoint == -1) {
			elements = []
			var i = 0
            while(i < asNumber) {
                elements.push(1)
                i ++
            }
        }
    }


	/** * The final array of items (in real sizes) */
	const array = (() => {
		var usedSpace = 0
        var totalFractions = 0

        var items = {}

		/**
		 * Checks a text value and see if it is a fraction or a direct number point, and an integrer based number value
		 * @param {String} element a part of the config values, for example a grid_column input of 1 1 1 would result in expand being called 3 times with '1' as the element argument
		 * @returns {{numberValue:String, isDirectPoint:Boolean}} numberValue is the real figma screen value for the passed element
		 */
		function expand(element) {
			element = element.toString()
            const replaced = element.replace('pt', '')
            const isDirectPoint = (element !== replaced)

            element = (isDirectPoint) ? element.replace('pt', '') : element
            const numberValue = parseInt(element)

            return { numberValue:numberValue, isDirectPoint:isDirectPoint }
		}

		// Evaluates the given numberValue as a whole number
		function evaluateAsWholeNumber(i, numberValue) {
			usedSpace += numberValue
            items[i] = numberValue
		}

		// Evaluates the given numberValue as a franction
		function evaluateAsFraction(i, numberValue) {
			const availiableSpace = (realSize - usedSpace) - ((elements.length - 1) * gap)
            const columnWidth = (availiableSpace / totalFractions)
            items[i] = (columnWidth * numberValue)
		}

		var index = 0
		var evaluatingAs = 0
		while (index < elements.length) {
			const element = elements[index]
			const { isDirectPoint, numberValue } = expand(element)

			index += 1
			if (evaluatingAs === 0) {
				if (isDirectPoint) evaluateAsWholeNumber((index - 1), numberValue)
				else totalFractions += numberValue
			} else if (!isDirectPoint && evaluatingAs === 1) {
				evaluateAsFraction((index - 1), numberValue)
			}

			if (index === (elements.length) && evaluatingAs === 0) {
				evaluatingAs = 1
				index = 0
			}
		}
		
		return items
	})()

	const nearestDecimal = (val) => (Math.round(val * 100) / 100)
	return {
		gap:((useAppliedSize) => {
			if (useAppliedSize) return nearestDecimal((appliedSize / realSize) * gap)
			return gap
		}),
		items:((useAppliedSize) => {
			return Object.keys(array).sort((a,b) => (a > b)).map(i => {
				const val = array[i]
				if (useAppliedSize) return nearestDecimal((appliedSize / realSize) * val)
				return val
			})
		})
	}
});
;// CONCATENATED MODULE: ./scripts/controllers/selection.js



/**
 * @type {FigmaSelection}
 */
var selection = {}

/**
 * Checks if the current selection within the editing programme is empty
 * @returns {Boolean}
 */
const isSelectionEmpty = () => (selection.width == 0 || selection.height == 0)

const setSelection = (width, height, name) => {
    selection = (!width || !height)
        ? {width:0, height:0, name:''}
        : {width:width, height:height, name:name}

    document.dispatchEvent(new CustomEvent(EVENTS.SelectionChanged, {
        detail:(isSelectionEmpty()) ? {empty:true} : selection
    }))
}

window.addEventListener('message', (message) => {
    const data = message.data.pluginMessage

    /**
     * If the data.type of the event is selection change then call the setSelection function with the new item, or with null if there is no item
     */
    if (data.type == WINDOW_EVENTS.SelectionChanged) {
        if (data.item) setSelection(data.item.width, data.item.height, data.item.name)
        else setSelection(null)
    }
})

/* harmony default export */ const controllers_selection = ({
    /**
     * @type {FigmaSelection}
     */
    get current() { return selection },

    isSelectionEmpty:isSelectionEmpty
});
;// CONCATENATED MODULE: ./scripts/controllers/config.js


/**
 * The default configuration values
 * @type {CREATE_CONFIG_TYPE}
 */
const configValues = {
    grid_columns:'5',
    grid_columns_gap:'0',
    grid_rows:'2',
    grid_rows_gap:'0'
}

/**
 * Listen for changes in the user interface and change the stored values accordingly
 */
document.addEventListener(EVENTS.ConfigChanged, (e) => {
    let detail = e.detail
    let detailfor = detail['for']
    let detailNewValue = detail['newValue']
    if (!detailfor || !detailNewValue) return

    configValues[detailfor] = detailNewValue
})

/* harmony default export */ const config = ({
    /**
     * Get all the configuration options
     * @returns {Object<String,String>}
     */
    getAll() {
        return configValues
    },

    /**
     * Override the configu values with new ones and dispatch and event that the config values have been changed
     * @param {Object<String, String>} withValues 
     */
    setAll(withValues) {
        Object.keys(configValues).forEach(key => {
            configValues[key] = withValues[key] || configValues[key]
            const value = configValues[key]
            document.dispatchEvent(new CustomEvent(EVENTS.ConfigChanged, {
                detail:{for:key, newValue:value}
            }))
        })
    },
    
    /**
     * Get the configuration option for 'key'
     * @param {String} key 
     * @returns {String}
     */
    getValue(key) { 
        return configValues[key] || null
    },

    /**
     * Set a configuration value manually
     * @param {String} key 
     * @param {String} newValue 
     * @returns 
     */
    setValue(key, newValue) {
        configValues[key] = newValue
        return configValues[key]
    }
});
;// CONCATENATED MODULE: ./scripts/controllers/merging.js



var merges = {}

/**
 * Add value to merges in merges[x][y]
 * @param {PreviewMerger} context
 * @returns {PreviewMerger}
 */
function addToMerge(context) {
    const x = context.x
    const y = context.y
    merges[x] = merges[x] || {}
    merges[x][y] = context

    return merges[x][y]
}

/**
 * Remove value from merges in merges[x][y]
 * @param {Number} x 
 * @param {Number} y 
 * @returns {Boolean}
 */
function removeFromMerge(x,y) {
    if (merges[x] && merges[y])
        delete merges[x][y]

    if (Object.keys(merges[x]).length === 0)
        delete merges[x]
        
    return true
}

/**
 * Get the value at merges[x][y]
 * @param {Number} x 
 * @param {Number} y 
 * @returns 
 */
function getMergeValue(x,y) {
    const mergeX = merges[x]||{}
    return mergeX[y]
}


/* harmony default export */ const merging = ({
    /**
     * Add a merger (call from the user interface when releases his mouse over the preview grid)
     * @param {PreviewMerger} context
     * @returns {PreviewMerger}
     */
    addMerge(context) {
        return addToMerge(context)
    },

    /**
     * Override a merger preview cell when the UI is refreshed due to a new layer selection or due to a configuration change
     * @param {Number} x 
     * @param {Number} y 
     * @param {HTMLElement} newPreview 
     * @returns 
     */
    overridePreviewMerge(x,y,newPreview) {
        const cell = getMergeValue(x,y)
        if (!cell) return

        if (cell.preview) cell.preview.remove()
        merges[x][y].preview = newPreview

        return merges[x][y]
    },

    /**
     * Remove a merger from the grid and from storage
     * @param {Number} x 
     * @param {Number} y 
     * @param {HTMLElement} cellNode 
     * @returns {Boolean}
     */
    removeMerge(x,y,cellNode) {
        const cell = getMergeValue(x,y)
        if (!cell) return false

        if (cell.preview) cell.preview.remove()

        removeFromMerge(x,y)
        cellNode.gridDescription.merged = null

        return true
    },

    /**
     * Get the details for the mergere at x,y (if exists)
     * @param {Number} x 
     * @param {Number} y 
     * @returns {PreviewMerger}
     */
    detailForMerge(x,y) {
        return getMergeValue(x,y)
    },

    /**
     * Clear the current merges
     */
    clear() {
        merges = {}
        document.dispatchEvent(new CustomEvent(EVENTS.MergesCleared, {}))
    },

    /**
     * Has the user merged any grid cells?
     * @returns {Boolean} True if the user has merged cells
     */
    doesIncludeMerges() {
        return (Object.keys(merges).length > 0)
    },

    /**
     * 
     * @param {function(Merger):void} callback 
     * @returns 
     */
    forEach(callback) {
        if (!callback.call) return
        Object.values(merges).map(yValue => Object.values(yValue)).flat().forEach(i => callback({
            x:i.x, y:i.y, w:i.width, h:i.height
        }))
    }
});
;// CONCATENATED MODULE: ./scripts/interface/grid-preview/merging-starting-point-indicator.js
const applied = {}

/**
 * Add a starting point indicator to the grid
 * @param {HTMLElement} gridMergeContainer 
 * @param {Number} x 
 * @param {Number} y 
 */
function add(gridMergeContainer, x, y) {
    const node = document.createElement('div')
    node.style.width = '8px'
    node.style.height = '8px'
    node.style.borderRadius = '4px'
    node.style.backgroundColor = '#F0AA45'
    node.style.border = '1px solid black'
    node.style.position = 'absolute'

    node.style.gridRowStart = `${y + 1}`
    node.style.gridRowEnd = `${y + 1}`
    node.style.gridColumnStart = `${x + 1}`
    node.style.gridColumnEnd = `${x + 1}`

    node.style.transform = `translate(-50%, -50%)`
    node.style.left = '50%'
    node.style.top = '50%'

    gridMergeContainer.appendChild(node)

    applied[x] = applied[x] || {}
    applied[x][y] = node
}

/**
 * Remove a merge starting point indicator from the grid
 * @param {Number} x 
 * @param {Number} y 
 */
function remove(x, y) {
    const toRemove = (applied[x]||{})[y]
    if (toRemove)
        toRemove.remove()
}

/* harmony default export */ const merging_starting_point_indicator = ({ add, remove });
;// CONCATENATED MODULE: ./scripts/util/calculate-xyhw.js
/**
 * Calculates the final x,y, width, and height based on the given properties
 * use when merging cells for cases such as width being -1 or -2 requiring offset but without changing the starting cell
 */
/* harmony default export */ const calculate_xyhw = ((x,y,w,h) => {
    if (w < 0) {
        w = Math.abs(w)
        x -= w
    }

    if (h < 0) {
        h = Math.abs(h)
        y -= h
    }

    x = x + 1
    y = y + 1

    return {
        x:x,y:y,h:h,w:w
    }
});
;// CONCATENATED MODULE: ./scripts/interface/grid-preview/apply-preview.js


function applyPreviewPropertiesToNode(node,xPos,yPos,width,height) {
    if (!node) return

    xPos = parseInt(xPos)
    yPos = parseInt(yPos)
    width = parseInt(width)
    height = parseInt(height)

    const {x,y,h,w} = calculate_xyhw(
        xPos,
        yPos,
        width,
        height
    )

    node.style.gridRowStart = `${y}`
    node.style.gridRowEnd = `${y + h + 1}`
    node.style.gridColumnStart = `${x}`
    node.style.gridColumnEnd = `${x + w + 1}`
}

;// CONCATENATED MODULE: ./scripts/interface/grid-preview/create-merge-cell.js


/**
 * Generates a random colour from TYPES.PREVIEW_COLORS to be used with a preview cell node
 * @returns {String} a hex code to use as a random colour
 */
 function randomColour() {
    const arr = [
        '#E94E3D',
        '#EF9A37',
        '#F6CD46',
        '#69C466',
        '#5FC4BD',
        '#5EAEC4',
        '#387AF6',
        '#A259D7',
        '#E9445A',
        '#9D8563' ]

    const index = Math.floor(Math.random() * (arr.length - 1))
    return `${arr[index]}AA`
}

/**
 * Creates a node that will be used a preview for the merge operation
 * @returns {HTMLElement}
 */
function createPreviewMergeNode() {
    const node = document.createElement('div')
    node.style.backgroundColor = randomColour()
    node.style.position = 'relative'
    node.style.left = `${OPTIONS.GridPadding}px`
    node.style.top = `${OPTIONS.GridPadding}px`
    node.style.width = `calc(100% - ${OPTIONS.GridPadding*2}px)`
    node.style.height = `calc(100% - ${OPTIONS.GridPadding*2}px)`
    node.style.opacity = '0.85'
    node.style.borderRadius = `${OPTIONS.GridCornerRadius}px`
    node.style.pointerEvents = 'none'
    node.style.transition = 'filter 0.1s'

    return node
}
;// CONCATENATED MODULE: ./scripts/interface/grid-preview/preview-grabber.js









var overNode;

var grabbingStartNode;
var grabbingPreviewNode;

var grabbingX;
var grabbingY;

var grabbingWidth;
var grabbingHeight;

var gridCellsContainer;
var gridMergeContainer;

function preview_grabber_self() {
    return {

    }
}



/**
 * Applies styling (correct position and sizing) to the preview node for the merge operation
 * Called when the mouse moves to a different cell
 */
function applyPropertiesToPreviewNode() {
    applyPreviewPropertiesToNode(
        grabbingPreviewNode,
        grabbingX,
        grabbingY,
        grabbingWidth,
        grabbingHeight
    )
}

/**
 * Cancel the current merger
 * @param {Boolean} deletesPreviewNode should the preview node be deleted (merge operation cancelled) or be kept (merge operation confirmed)
 */
function cancelMerge(deletesPreviewNode) {
    if (grabbingPreviewNode && deletesPreviewNode)
        grabbingPreviewNode.remove()
    
    grabbingPreviewNode = null
    grabbingStartNode = null

    grabbingX = null
    grabbingY = null
    grabbingWidth = null
    grabbingHeight = null

    document.dispatchEvent(new CustomEvent(EVENTS.PreviewCellGrabEnd, {
        detail:preview_grabber_self()
    }))
}

/**
 * Apply the merge operation
 */
function applyMerge() {
    if (!grabbingPreviewNode && !grabbingStartNode)
        return
    
    merging_starting_point_indicator.add(gridMergeContainer, grabbingX, grabbingY)

    grabbingStartNode.gridDescription.merged = merging.addMerge({
        x:grabbingX, y:grabbingY, width:grabbingWidth, height:grabbingHeight, preview:grabbingPreviewNode
    })

    cancelMerge(false)
}


/* harmony default export */ const preview_grabber = ({
    /**
     * Set the cells container from the grid-preview-ui script
     */
    set gridCellsContainer(newValue) { gridCellsContainer = newValue },
    /**
     * Set the merge container form the grid-preview-ui script
     */
    set gridMergeContainer(newValue) { gridMergeContainer = newValue },


    /**
     * Call when the user right clicks in the preview grid
     * @param {MouseEvent} e 
     */
    contextClick:(e) => {
        /**
         * Check if the user is hovering over a node, if not then return
         * Check the nodes merged status, if it is not merged then reutnr
         * 
         * Call the merging controller with the x and y coordinates of the node to clear
         */
        if (!overNode) return
        if (overNode.gridDescription.merged == null) return
    
        merging.removeMerge(overNode.gridDescription.x, overNode.gridDescription.y, overNode)
        merging_starting_point_indicator.remove(overNode.gridDescription.x, overNode.gridDescription.y)
    },

    /**
     * Call when the user clicks down in the preview grid
     * @param {MouseEvent} e 
     */
    mouseDown:(e) => {
        if (e.which !== 1) return
        if (!overNode) return
        if (overNode.gridDescription.merged) return

        grabbingStartNode = overNode

        grabbingPreviewNode = createPreviewMergeNode()
        grabbingX = grabbingStartNode.gridDescription.x
        grabbingY = grabbingStartNode.gridDescription.y

        grabbingWidth = 0
        grabbingHeight = 0

        gridMergeContainer.appendChild(grabbingPreviewNode)
        applyPropertiesToPreviewNode()

        document.dispatchEvent(new CustomEvent(EVENTS.PreviewCellGrabBegin, {
            detail:preview_grabber_self()
        }))
    },

    /**
     * Call when the user releases a click in the preview grid
     * @param {MouseEvent} e 
     */
    mouseUp:(e) => {
        if (e.which !== 1) return
        if (!grabbingPreviewNode && !grabbingStartNode) {
            cancelMerge(true)
        } else {
            applyMerge()
        }
    },

    /**
     * Call when the user moves the mouse within the preview grid
     * @param {MouseEvent} e 
     */
    mouseMove:(e) => {
        const newOverNode = (() => {
            const node = e.target
            return (node.gridDescription) ? node : null
        })()

        const _over = overNode
        overNode = newOverNode

        if (_over) {
            const mergeForCell = merging.detailForMerge(
                _over.gridDescription.x,
                _over.gridDescription.y
            )

            if (mergeForCell && mergeForCell.preview) {
                mergeForCell.preview.style.filter = ''
                mergeForCell.preview.style.zIndex = ''
            }

            _over.style.backgroundColor = 'unset'
        }
        
        if (overNode) {
            const mergeForCell = merging.detailForMerge(
                overNode.gridDescription.x,
                overNode.gridDescription.y
            )

            if (mergeForCell && mergeForCell.preview) {
                mergeForCell.preview.style.filter = 'brightness(2)'
                mergeForCell.preview.style.zIndex = '55'
            }
            
            overNode.style.backgroundColor = '#00a2ff'
        }

        if (grabbingPreviewNode && overNode) {
            grabbingWidth = (overNode.gridDescription.x) - grabbingX
            grabbingHeight = (overNode.gridDescription.y) - grabbingY

            applyPropertiesToPreviewNode()
        }
    }
});

;// CONCATENATED MODULE: ./scripts/interface/grid-preview/grid-preview-ui.js














/**
 * Get the root grid object found in the interface and add a merge container and cells container to it
 */
const gridRoot = document.querySelector('#grid-root')

/**
 * The merge container will be used to add the merge squares in
 */
const grid_preview_ui_gridMergeContainer = document.createElement('div')
grid_preview_ui_gridMergeContainer.classList.add('merge-container')

/**
 * The cells container will be used to show the individual squares on the grid
 */
const grid_preview_ui_gridCellsContainer = document.createElement('div')
grid_preview_ui_gridCellsContainer.classList.add('cells-container')

/**
 * Add the newly created elements to the root grid
 */
gridRoot.appendChild(grid_preview_ui_gridCellsContainer)
gridRoot.appendChild(grid_preview_ui_gridMergeContainer)

/**
 * Assign the newly created containers to the preview grabber utility helper
 */
preview_grabber.gridCellsContainer = grid_preview_ui_gridCellsContainer
preview_grabber.gridMergeContainer = grid_preview_ui_gridMergeContainer


/**
 * 
 * @param {*} node 
 * @param {*} param1 
 */
const applyGridPatternToNode = (node, {xItems, yItems, xGap, yGap}) => {
    node.style.display = 'grid'
    node.style.gridTemplateColumns = xItems.map(i => `${i}px`).join(' ')
    node.style.gridTemplateRows = yItems.map(i => `${i}px`).join(' ')
    node.style.columnGap = `${xGap}px` 
    node.style.rowGap = `${yGap}px` 
    node.style.justifyContent = 'center'
}

function refreshLayout() {
    Array.from(grid_preview_ui_gridMergeContainer.children).forEach(child => child.remove())
    Array.from(grid_preview_ui_gridCellsContainer.children).forEach(child => child.remove())

    /**
     * If nothing is selected than set the height of the grid preview to 20px
     */
    if (controllers_selection.isSelectionEmpty()) {
        const emptyPatternOptions = { xItems:[0], yItems:[0], xGap:0, yGap:0 }
        applyGridPatternToNode(grid_preview_ui_gridMergeContainer, emptyPatternOptions)
        applyGridPatternToNode(grid_preview_ui_gridCellsContainer, emptyPatternOptions)
        return
    }

    /**
     * If a layer is selected than automatically assign the height using unset
     */
    grid_preview_ui_gridMergeContainer.style.height = 'unset'
    grid_preview_ui_gridCellsContainer.style.height = 'unset'
    grid_preview_ui_gridMergeContainer.style.backgroundColor = 'unset'


    /**
     * Evalute the pattern using the given options to create the grid and cell merge previews
     */
    const pattern = evaluatePattern()

    const patternOptions = {
        xItems:pattern.column.items(true), yItems:pattern.row.items(true),
        xGap:pattern.column.gap(true), yGap:pattern.row.gap(true)
    }

    /**
     * Loop through each pattern row and create the preview node and the merged node (if cell is merged)
     */
    // var items = {}
    var y = 0
    while (y < patternOptions.yItems.length) {
        var x = 0

        /**
         * For each cell (run through y and x lengths) create a new preview cell
         * assign a border
         * check if cell is the origin of a merge
         * assigns a cellDescription variable (so that the grid preview knows what cell is being hovered on)
         * appends the child to the gridCellsContainer element
         */
        while (x < patternOptions.xItems.length) {
            const newCellNode = document.createElement('div')
            newCellNode.style.border = `1px solid #00000026`

            /**
             * Call the merging controller and fetch if cell at x,y has been merged
             * if so then create a new preview cell and call the merge controllers overridePreviewMerge function
             *     then append the new merge cell to the gridMergeContainer element
             */
            const existingMerge = merging.detailForMerge(x, y)
            if (existingMerge) {
                const newMergeCell = createPreviewMergeNode()
                merging.overridePreviewMerge(x,y,newMergeCell)

                applyPreviewPropertiesToNode(newMergeCell, x,y,existingMerge.w,existingMerge.h)
                grid_preview_ui_gridMergeContainer.appendChild(newMergeCell)

                merging_starting_point_indicator.add(grid_preview_ui_gridMergeContainer, x, y)
            }

            newCellNode.gridDescription = {
                id:(Math.random().toString()),
                x:x, y:y,
                merged:existingMerge||null
            }
            
            grid_preview_ui_gridCellsContainer.appendChild(newCellNode)

            x += 1
        }

        y += 1
    }

    applyGridPatternToNode(grid_preview_ui_gridMergeContainer, patternOptions)
    applyGridPatternToNode(grid_preview_ui_gridCellsContainer, patternOptions)
}

/**
 * Listen for selection chagnes or configuration changes so that the layout can be refreshed
 */
document.addEventListener(EVENTS.SelectionChanged, refreshLayout)
document.addEventListener(EVENTS.ConfigChanged, refreshLayout)
document.addEventListener(EVENTS.MergesCleared, refreshLayout)
document.addEventListener(EVENTS.MergesUpdated, refreshLayout)



/**
 * Assign default events for the correlating preview grabber utility functions
 * (Required to make the cells draggab le)
 */
document.body.addEventListener('contextmenu', (e) => preview_grabber.contextClick(e))
document.body.addEventListener('mousedown', (e) => preview_grabber.mouseDown(e))
document.body.addEventListener('mouseup', (e) => preview_grabber.mouseUp(e))
document.body.addEventListener('mousemove', (e) => preview_grabber.mouseMove(e))

/**
 * Add PreviewCellGrabBegin/End events to change the cursor to a grabber
 */
document.addEventListener(EVENTS.PreviewCellGrabBegin, () => { document.body.style.cursor = 'grabbing' })
document.addEventListener(EVENTS.PreviewCellGrabEnd, () => { document.body.style.cursor = 'auto' })


/* harmony default export */ const grid_preview_ui = ({
    get rootGridElement() { return gridRoot },
});
;// CONCATENATED MODULE: ./scripts/handlers/evalute-pattern.js







/**
 * Converts the Figma layer selection, the configuration (rows, columns, and gap inputs) and the container that previews the grid to return an array of every cell and their respective size
 * @param {FigmaSelection} selection 
 */
function evaluatePattern() {
    var w = controllers_selection.current.width
    var h = controllers_selection.current.height

    const configValues = config.getAll()
    const patternContainer = grid_preview_ui.rootGridElement

    /**
     * Get the ratio of the selected element by dividing its width by its height
     * If the ratio is smaller than one (is portrait) then set the height to 300 points and calculate the new width based on the aspect ratio
     * If the ratio is larger than one (is horizontal) then set the width to the maximum width for the grid preview element and then set the height based on the aspect ratio
     */
    const ratio = w / h
    if (ratio < 1) {
        h = 300
        w = h * ratio
    } else {
        w = patternContainer.getBoundingClientRect().width
        h = w / ratio
    }

    return {
        column:expand_grid({
            pattern:configValues.grid_columns,
            gap:configValues.grid_columns_gap,
            realSize:controllers_selection.current.width,
            appliedSize:w
        }),
        row:expand_grid({
            pattern:configValues.grid_rows,
            gap:configValues.grid_rows_gap,
            realSize:controllers_selection.current.height,
            appliedSize:h
        })
    }
}
;// CONCATENATED MODULE: ./scripts/util/communicator.js
/**
 * @typedef {'create-cells'|'undo'| 'save-grid'|'delete-grid'} PostType
 * @typedef {'selection'} ListenType
 */

/* harmony default export */ const communicator = ({
    /**
     * 
     * @param {PostType} type 
     * @param {Object} data 
     */
    postToFigma:(type, data) => {
        parent.postMessage({
            pluginMessage:{
                type:type,
                ...data,
            }
        }, '*')
    }
});
;// CONCATENATED MODULE: ./scripts/controllers/to-element.js






/**
 * Pushes the layout to the figma layer selected by calculating where it should go and creating an array of the final new layers (each cell)
 * @param {{xItems:Array<Number>, yItems:Array<Number>, xGap:Number, yGap:Number}} param0 
 * @param {{ colour:String, replaceSelected:Boolean }} options 
 */
/* harmony default export */ function to_element({xItems, yItems, xGap, yGap}, options) {
    var finalItems = []
    var currentXPosition = 0
    var currentYPosition = 0

    /** * Check if the user has merged, if so then create the grid differently */
    if (merging.doesIncludeMerges()) {
        /** * Loop thorugh every merger */
        merging.forEach(merge => {
            const finalPlacement = calculate_xyhw(merge.x, merge.y, merge.w, merge.h)
            finalPlacement.x = finalPlacement.x - 1
            finalPlacement.y = finalPlacement.y - 1

            function getPoint(arr, gap, index, inclusive) {
                var current = 0
                var i = 0
                var hasFinished = false
    
                while (!hasFinished) {
                    if (i === index) {
                        if (inclusive) current += arr[i]
                        hasFinished = true
                    } else { current += arr[i] + gap }
                    i ++
                }
    
                return current
            }

            const startX = getPoint(xItems, xGap, finalPlacement.x, false)
            const startY = getPoint(yItems, yGap, finalPlacement.y, false)
            const endX = getPoint(xItems, xGap, finalPlacement.x + finalPlacement.w, true)
            const endY = getPoint(yItems, yGap, finalPlacement.y + finalPlacement.h, true)
            const width = endX - startX
            const height = endY - startY
            
            finalItems.push({
                x:startX, y:startY,
                width:width, height:height,
            })    
        })
    } else {
        var yIndex = 0
        while (yIndex < yItems.length) {
            var xIndex = 0
            currentXPosition = 0
            const currentYItem = yItems[yIndex]
            while (xIndex < xItems.length) {
                const currentXItem = xItems[xIndex]
                finalItems.push({
                    x:currentXPosition, y:currentYPosition,
                    width:currentXItem, height:currentYItem,
                })

                currentXPosition += (currentXItem + xGap)
                xIndex ++
            }

            currentYPosition += (currentYItem + xGap)
            yIndex ++
        }
    }

    communicator.postToFigma('create-cells', {
        id:Math.random().toString().slice(4),
        items:finalItems,

        ...options
    })
}
;// CONCATENATED MODULE: ./scripts/controllers/save-grid.js





/**
 * The layouts made by the user that have been fetched using the window.onmessage event
 * @type {Array<SavedGrid>}
 */
var customLayouts = []

/**
 * Default premade layouts that are always availiable
 * @type {Array<SavedGrid>}
 */
const premadeLayouts = [
    {
        name: "Golden Ratio",
        id: "golden-ratio",
        inputs: {grid_columns: "13", grid_rows: "8", grid_columns_gap: "0", grid_rows_gap: "0"},
        mergedCells: [
            {x: 0, y: 0, w: 7, h: 7},
            {x: 8, y: 0, w: 4, h: 4},
            {x: 8, y: 5, w: 0, h: 0},
            {x: 8, y: 6, w: 1, h: 1},
            {x: 9, y: 5, w: 0, h: 0},
            {x: 12, y: 5, w: -2, h: 2}
        ]
    },
    {
        name: "Column Grid (12 Column)",
        id: "ipad-split",
        inputs: {grid_columns: "12", grid_rows: "1", grid_columns_gap: "6", grid_rows_gap: "0"}
    },
    {
        name: "iPad App With Sidebar",
        id: "ipad-with-sidebar",
        inputs: {grid_columns: "220pt 1", grid_rows: "1", grid_columns_gap: "0", grid_rows_gap: "0"}
    },
    {
        name: "Notch iPhone App Layout",
        id: "ios-app-layout",
        inputs: {grid_columns: "1", grid_rows: "140pt 1 83pt", grid_columns_gap: "0", grid_rows_gap: "0"}
    },
    {
        name: "Rule Of Threes",
        id: "rule-of-threes",
        inputs: {grid_columns: "3", grid_rows: "3", grid_columns_gap: "0", grid_rows_gap: "0"}
    }
]

/**
 * Listen for the FetchedPresavedFromStorage event that gets called when the localStorage is read to fetch what the user has saved
 * @param {Event} message 
 * @returns 
 */
window.addEventListener('message', (message) => {
    const data = message.data.pluginMessage

    if (data.type === WINDOW_EVENTS.FetchedPresavedFromStorage) {
        if (!data.items || !Array.isArray(data.items)) return

        customLayouts = data.items
        document.dispatchEvent(new CustomEvent(EVENTS.PresavedArrayChanged, {
            detail:[
                ...customLayouts,//premadeLayouts,
                ...premadeLayouts
            ]
        }))
    }
})

/* harmony default export */ const save_grid = ({
    /**
     * Gets an array with all the premade grids that are availiable, both custom and default ones
     * @returns {Array<SavedGrid>}
     */
    getPresavedGrids() {
        return [
            ...customLayouts,
            ...premadeLayouts
        ]
    },

    /**
     * Gets a presaved grid using a passed ID
     * @param {String} id 
     * @returns {SavedGrid}
     */
    getPresavedGridsWithID(id) {
        const items = [
            ...customLayouts,
            ...premadeLayouts
        ]

        var i = 0
        var found;
        while (i < items.length && found == null) {
            const cur = items[i]
            if (cur.id === id) found = cur

            i ++ 
        }

        return found || null
    },

    /**
     * Calls for the grid with the given ID to be from storage
     * @param {String} id 
     */
    removePresavedGrid(id) {
        communicator.postToFigma('delete-grid', { id:id })
    },

    /**
     * Adds the current grid layout and passed config 
     * @param {String} withName 
     * @param {Object} configOptions
     */
    addPresavedGrid(withName, configOptions) {
        var mergedArray = []
        merging.forEach(merge => {
            var duplicate = JSON.parse(
                JSON.stringify(merge)
            )

            delete duplicate.preview
            mergedArray.push(duplicate)
        })

        const newID = Math.random().toString().slice(3)
        const currentInput = configOptions
        communicator.postToFigma('save-grid', {
            id:newID,
            name:withName,
            inputs:currentInput,
            mergedCells:mergedArray
        })
    },

});
;// CONCATENATED MODULE: ./scripts/interface/config-ui.js



/**
 * Get the inputs for the configuration panel
 */
const inputs = {
    grid_columns:document.querySelector('#grid-columns'),
    grid_columns_gap:document.querySelector('#grid-columns-gap'),
    grid_rows:document.querySelector('#grid-rows'),
    grid_rows_gap:document.querySelector('#grid-rows-gap')
}

/**
 * For each input set its value to the value set as default from the config controller
 */
Object.keys(inputs).forEach(key => 
    inputs[key].value = config.getValue(key)
)

/**
 * Listen for input changes within the document
 */
document.addEventListener('change', (e) => {
    /**
     * If the events target has an attribute of config then call an EVENTS.ConfigChanged event that will post to the config controller
     */
    const configAttribute = e.target.getAttribute('config')
    if (configAttribute == null) return

    document.dispatchEvent(new CustomEvent(EVENTS.ConfigChanged, {
        detail:{
            for:configAttribute,
            newValue:e.target.value
        }
    }))
})

/**
 * Listen for EVENTS.ConfigChanged to keep both the UI and config controller in sync
 */
document.addEventListener(EVENTS.ConfigChanged, (e) => {
    let detail = e.detail
    let detailfor = detail['for']
    let detailNewValue = detail['newValue']
    if (!detailfor || !detailNewValue) return

    inputs[detailfor].value = detailNewValue
})
;// CONCATENATED MODULE: ./scripts/interface/help-button.js
/**
 * Configures the help menu
 */
 const helpSection = document.querySelector('.help-screen')
 const helpSectionOpenButton = document.querySelector('.help-button')
 const helpSectionCloseButton = document.querySelector('.help-screen .button')
 
 /** * Listen for click on the help button to open the helpSection */
 helpSectionOpenButton.addEventListener('click', () => {
     helpSection.classList.add('opening')
 })
 
 /** * Listen for a click on the close button to close the help section */
 helpSectionCloseButton.addEventListener('click', () => {
     /** * Called on the animationend event, removes the class that sets the closing animation and remove the listener */
     function e() {
         helpSection.classList.remove('closing')
         helpSection.removeEventListener('animationend', e)
     }
 
     helpSection.classList.remove('opening')
     helpSection.classList.add('closing')
 
     helpSection.addEventListener('animationend', e)
 })

 
;// CONCATENATED MODULE: ./scripts/interface/overlay-ui.js
/**
 * A function to close and send a reject Promise to the open overlay
 * @type {function():void}
 */
var currentOverlay = null

/**
 * The SVG path to create a trsah icon SVG for the itemArrayOverlay
 */
const trashIcon = `<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M155.148 482H356.626C369.59 482 379.917 478.387 387.605 471.161C395.293 463.935 399.439 453.925 400.042 441.129L414.061 126.129H447.302C451.372 126.129 454.839 124.699 457.704 121.839C460.568 118.978 462 115.516 462 111.452C462 107.387 460.568 103.925 457.704 101.065C454.839 98.2043 451.372 96.7742 447.302 96.7742H64.472C60.5525 96.7742 57.1606 98.2043 54.2964 101.065C51.4321 103.925 50 107.387 50 111.452C50 115.516 51.4321 118.978 54.2964 121.839C57.1606 124.699 60.5525 126.129 64.472 126.129H97.9385L112.184 441.129C112.787 453.925 116.858 463.935 124.395 471.161C132.083 478.387 142.334 482 155.148 482ZM188.615 420.806C185.147 420.806 182.283 419.753 180.022 417.645C177.761 415.538 176.555 412.753 176.404 409.29L169.846 174.226C169.696 170.763 170.751 167.978 173.012 165.871C175.273 163.613 178.288 162.484 182.057 162.484C185.524 162.484 188.389 163.538 190.65 165.645C192.911 167.753 194.117 170.613 194.268 174.226L200.825 409.065C200.976 412.527 199.921 415.387 197.66 417.645C195.398 419.753 192.383 420.806 188.615 420.806ZM256 420.806C252.231 420.806 249.141 419.753 246.729 417.645C244.468 415.387 243.337 412.527 243.337 409.065V174.226C243.337 170.763 244.468 167.978 246.729 165.871C249.141 163.613 252.231 162.484 256 162.484C259.769 162.484 262.784 163.613 265.045 165.871C267.457 167.978 268.663 170.763 268.663 174.226V409.065C268.663 412.527 267.457 415.387 265.045 417.645C262.784 419.753 259.769 420.806 256 420.806ZM323.159 420.806C319.39 420.806 316.375 419.753 314.114 417.645C312.004 415.387 310.948 412.602 310.948 409.29L317.732 174.226C317.883 170.613 319.089 167.753 321.35 165.645C323.611 163.538 326.476 162.484 329.943 162.484C333.712 162.484 336.727 163.613 338.988 165.871C341.249 167.978 342.304 170.763 342.154 174.226L335.37 409.516C335.37 412.828 334.239 415.538 331.978 417.645C329.717 419.753 326.777 420.806 323.159 420.806ZM161.027 103.323H196.077V65.1613C196.077 59.2903 197.886 54.6237 201.504 51.1613C205.273 47.6989 210.323 45.9677 216.654 45.9677H294.894C301.225 45.9677 306.2 47.6989 309.818 51.1613C313.587 54.6237 315.471 59.2903 315.471 65.1613V103.323H350.52V63.3548C350.52 47.6989 345.696 35.4301 336.048 26.5484C326.551 17.5161 313.436 13 296.703 13H214.619C198.037 13 184.921 17.5161 175.273 26.5484C165.776 35.4301 161.027 47.6989 161.027 63.3548V103.323Z" fill="#EF453B"/>
</svg>`


/**
 * Define a type for the input options that the openOverlay function takes
 * use when creating overlay UI items or when calling the openOverlay function
 * @typedef {{ title:String, classList:Array<String>, includeCancelButton:Boolean, includeCancelButton:Boolean, body:function():Array<HTMLElement>, onConfirm:function(HTMLElement):any }} OverlayOptions
 */


/**
 * An overlay option that provides the user with an ability to enter a text and confirm
 * used when saving grids
 * @returns {OverlayOptions}
 */
function inputOverlay() {
    return {
        title:'Save Grid As...',
        classList:['equally-divided'],
        includeConfirmButton:true,
        includeCancelButton:true,
        body:() => {
            const input = document.createElement('input')
            input.placeholder = 'Enter value...'
            
            return [input]
        },
        onConfirm:(body) => {
            const input = body.querySelector('input')
            const val = input.value
            if (val.trim() === '') return null
            return val
        }
    }
}

/**
 * An overlay option that provides the user the ability to edit and delete items in a list
 * used when editing previuly saved grids
 * @param {Array<{id:String, name:String}>} items
 * @param {function(string):void} remove
 * @returns {OverlayOptions}
 */
 function itemArrayOverlay(items, remove) {
    return {
        title:'Edit Saved Items',
        classList:['flex'],
        includeCancelButton:true,
        onConfirm:(body) => { return null },
        body:() => {
            const list = document.createElement('ul')
            list.style = 'list-style: none; width: 100%; height: 100%; padding: 0 12px 12px 12px; margin: 0; box-sizing: border-box'
                
            items.forEach(item => {
                const view = document.createElement('li')
                view.style = 'display:flex; padding: 16px; border-bottom: 1px solid black; align-items: center; background-color: #ffffff3b; border-radius: 6px; margin-bottom: 6px'
    
                const label = document.createElement('span')
                label.innerText = item.name//'View Name'
                label.style = 'flex-grow: 100; color: white'
    
                const deleteButton = document.createElement('svg')
                deleteButton.style = 'width: 22px; height: 22px; cursur: pointer'
                deleteButton.innerHTML = trashIcon
    
                const rightContainer = document.createElement('div')
                rightContainer.appendChild(deleteButton)
    
                view.appendChild(label)
                view.appendChild(rightContainer)
                list.appendChild(view)
    
                deleteButton.addEventListener('click', () => {
                    view.remove()
                    remove(item.id)
                })
            })    

            return [list]
        }
    }
}


/**
 * Closes the current overlay (if open)
 */
function closeOverlay() {
    if (currentOverlay) { currentOverlay() }
}

/**
 * Creates an overlay that the user can enter an input into.
 * @param {OverlayOptions} data 
 * @returns {Promise<String>} The input provided by the user
 */
function openOverlay(data) {
    /**
     * The part below constructs the overlay elements
     * Check out the Elements part of the Figma console to see what is going on here
     */
    const overlay = document.createElement('div')
    overlay.classList.add('input-overlay')
    overlay.classList.add('opening')
    data.classList.forEach(item => overlay.classList.add(item))

    const title = document.createElement('span')
    title.innerText = data.title
    title.classList.add('title')

    const topContainer = document.createElement('div')
    topContainer.classList.add('top-container')

    const bottomContainer = document.createElement('div')
    bottomContainer.classList.add('bottom-container')

    const confirmButton = document.createElement('span')
    confirmButton.id = 'confirm-button'
    confirmButton.innerText = 'Save Grid'

    const cancelButton = document.createElement('span')
    cancelButton.id = 'cancel-button'
    cancelButton.innerText = 'Cancel'

    overlay.appendChild(topContainer)
    overlay.appendChild(bottomContainer)

    topContainer.appendChild(title)
    document.body.appendChild(overlay)

    if (data.includeConfirmButton) bottomContainer.appendChild(confirmButton)
    if (data.includeCancelButton) bottomContainer.appendChild(cancelButton)

    const body = data.body()
    body.forEach(element => topContainer.appendChild(element))

    /** * Return a promise that is resolved when the user selects a value */
    return new Promise((resolve, reject) => {
        currentOverlay = (() => reject())

        cancelButton.addEventListener('click', () => reject())
        confirmButton.addEventListener('click', () => {
            const res = data.onConfirm(topContainer) //valueGetter()
            if (res) resolve(res)
        })
    }).finally(() => {
        overlay.classList.remove('opening')
        overlay.classList.add('closing')
        setTimeout(() => overlay.remove(), 290)
    })
}

/* harmony default export */ const overlay_ui = ({
    openOverlay: openOverlay,
    closeOverlay: closeOverlay
});


;// CONCATENATED MODULE: ./scripts/interface/save-dropdown.js







/**
 * Configure the buttons and dropdown that let the user select premade grids
 */
const selectSavedButton = document.querySelector('#select-saved')
const selectSavedDropdown = document.querySelector('#select-saved select')

/** * Simulate a click on the dropdown item if clicked on the dropdown button */
selectSavedButton.addEventListener('click', () => (selectSavedDropdown.click()))

/**
 * Listen for a change in the selection option in the dropdown (menu) and determain what should happen based on the ID of the option selected
 */
selectSavedDropdown.addEventListener('change', (e) => {
    const val = selectSavedDropdown.value
    
    if (val === 'save') {
        /** * If selection option == save then open an overlay with an input option that when confirmed, saves a new grid to local storage */
        overlay_ui.openOverlay(
            inputOverlay()
        ).then(value => save_grid.addPresavedGrid(value, config.getAll()))
    } else if (val === 'edit') {
        /** * If selection option == edit then open an overlay with the presaved grids that can be removed and renamed */
        overlay_ui.openOverlay(
            itemArrayOverlay(
                save_grid.getPresavedGrids().filter(i => {
                    return (i.isCustomMade)
                }),

                (id) => save_grid.removePresavedGrid(id)
            )
        ).finally(() => {})
    } else if (val != 'empty' && val != '----') {
        /**
         * If selection is any other value then attempt to get the grid with the given ID,
         * and if successful set merges and configuration to the ones from the grid
         */
        const found = save_grid.getPresavedGridsWithID(val)

        if (found) {
            // Set the config
            config.setAll(found.inputs)
            
            merging.clear()

            // Apply all merged cells in presaved grid
            Array.from(found.mergedCells || []).forEach(merged =>
                merging.addMerge(merged))

            // Update the merges preview
            document.dispatchEvent(new CustomEvent(EVENTS.MergesUpdated))
        }
    }

    /** * Revert dropdown to the placeholder element (no action selected) */
    selectSavedDropdown.selectedIndex = 0
}) 

/** * Listens for when the array of saved grids has changed (removed, updated) to refresh the selectors dropdown options */
document.addEventListener(EVENTS.PresavedArrayChanged, (e) => {
    const newArray = Array.from(e.detail)
    if (newArray == null || !Array.isArray(newArray)) return

    /**
     * Adds a dropdown item to the given option group to create the new dropdown children
     * @param {String} value The identifier for the dropdown option
     * @param {String} label The label for the dropdown item
     * @param {HTMLOptGroupElement} childOf The optgroup parent of the new item
     * @returns 
     */
    function createDropdownItem(value, label, childOf) {
        const item = document.createElement('option')
        item.innerText = label
        item.setAttribute('value', value)
        childOf.appendChild(item)

        return item
    }

    /** * Clear the contents of the dropdown */
    selectSavedDropdown.innerHTML = ''

    /** * The group that contains the actions availiable (edit, save current, ...) */
    const mainOptionGroup = document.createElement('optgroup')
    mainOptionGroup.setAttribute('label', 'Actions')

    /** * The group that contains the preexisting grid options (created in scripts/controllers/save-grid.js) */
    const preExistingOptionGroup = document.createElement('optgroup')
    preExistingOptionGroup.setAttribute('label', 'Pre-Made Layouts')

    /** * The group that contains the custom grid (made and saved by the user) */
    const suboptionsOptionGroup = document.createElement('optgroup')
    suboptionsOptionGroup.setAttribute('label', (newArray.length === 0) ? 'Nothing Saved Yet' : 'Saved History')

    /** * Create action items */
    createDropdownItem('empty', 'Saved...', mainOptionGroup)
    createDropdownItem('save', 'Save Current Layout', mainOptionGroup)
    createDropdownItem('edit', 'Edit Saved', mainOptionGroup)

    /** * Add sub groups to the dropdown */
    selectSavedDropdown.appendChild(mainOptionGroup)
    selectSavedDropdown.appendChild(suboptionsOptionGroup)
    selectSavedDropdown.appendChild(preExistingOptionGroup)

    /** * Loop thorugh the list of custom grids availiable and add them to the appropiate group */
    newArray.filter(i => (i.isCustomMade)).forEach(item =>
        createDropdownItem(item.id, item.name, suboptionsOptionGroup))

        /** * Loop thorugh the list of custom grids availiable and add them to the appropiate group */
    newArray.filter(i => (!i.isCustomMade)).forEach(item =>
        createDropdownItem(item.id, item.name, preExistingOptionGroup))
})



;// CONCATENATED MODULE: ./scripts/root/root.js















/**
 * Array of actions that should occur when the selection is changed
 */
var selectionActions = []
document.addEventListener(EVENTS.SelectionChanged, (e) => {
    const newSelection = e.detail
    if (newSelection.empty === true) selectionActions.forEach(i => (i.call) ? i(null) : ({}))
    else selectionActions.forEach(i => (i.call) ? i(newSelection) : ({}))
})


/**
 * Configure button that clears the merges
 */
const clearMergeButton = document.querySelector('#clear-merge')
clearMergeButton.addEventListener('click', () => merging.clear())
selectionActions.push(selection => {
    if (selection) clearMergeButton.style.opacity = '1'
    else clearMergeButton.style.opacity = '0.3'
}) 


/**
 * Configure the label that shows the name of the layer selected
 */
const selectedElementLabel = document.querySelector('#current-frame-name span')
selectionActions.push(selection => {
    if (selection) {
        selectedElementLabel.parentElement.style.opacity = '1'
        selectedElementLabel.innerText = selection.name
        selectedElementLabel.style.textDecoraction = ''
        selectedElementLabel.style.fontWeight = 400
    } else {
        selectedElementLabel.parentElement.style.opacity = '0.4'
        selectedElementLabel.innerText = 'Select Element...'
        selectedElementLabel.style.fontWeight = 600
        selectedElementLabel.style.textDecoraction = 'underline'
    } 
}) 


/**
 * Configure the buttons at the bottom of the interface that applies the created grid to the figma element
 */
const applyToElementButton = document.querySelector('#apply-to-element')
const applyToElementIcon = document.querySelector('#apply-to-element svg')
const applyToElementLabel = document.querySelector('#apply-to-element span')

const defaultApplyToElementText = applyToElementLabel.innerText
const noneSelectedApplyToElementText = 'Must Select Atleast One Layer'

applyToElementButton.addEventListener('click', () => {
    /**
     * Listen for clicks on the apply to element button
     * If clicked calculate the final grid and send that to the figma.post function
     */

    /** * Evalute the pattern using the given options to create the grid and cell merge previews */
    const pattern = evaluatePattern()

    /** * Call a function that sends the pattern over to the Figma layer using the correct sizing relative to the layer */
    to_element({
        xItems:pattern.column.items(false), yItems:pattern.row.items(false),
        xGap:pattern.column.gap(false), yGap:pattern.row.gap(false)
    }, {
        colour:document.querySelector('#cell-fill').value,
        replaceSelected:document.querySelector('#replace-selected').checked
    })
})
 
selectionActions.push(selection => {
    if (selection) {
        applyToElementButton.style.color = ''
        applyToElementButton.style.cursor = ''
        applyToElementButton.style.backgroundColor = ''

        applyToElementIcon.style.display = 'unset'
        applyToElementLabel.innerText = defaultApplyToElementText
    } else {
        applyToElementButton.style.color = '#848b92'
        applyToElementButton.style.cursor = 'not-allowed'
        applyToElementButton.style.backgroundColor = 'rgb(218 220 222)'

        applyToElementIcon.style.display = 'none'
        applyToElementLabel.innerText = noneSelectedApplyToElementText
    }
})



/**
 * Configure the buttons and dropdown that let the user select premade grids
 */
selectionActions.push(selection => {
    if (selection) selectSavedButton.style.display = ''
    else selectSavedButton.style.display = 'none'
})
;// CONCATENATED MODULE: ./index.js
/**
 * Import the UI element
 */


/**
 * Make sure that selection is empty on launch
 */
window.postMessage({
    pluginMessage: {
        type: 'selectionchange',
        item: null
    }
}, '*')
/******/ })()
;
	</script>
</body>